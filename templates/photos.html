{% extends "base.html" %}

{% block title %}Photos - My Website{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/photos.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/masonry.css') }}">
{% endblock %}

{% block content %}
<div class="photo-gallery-container">
    <!-- Gallery Header -->
    <div class="gallery-header">
        <h1 data-lang-photos="title">फोटो गैलरी</h1>
        <p data-lang-photos="subtitle">हमारे विभिन्न कार्यक्रमों और उत्सवों की सुंदर यादें</p>
    </div>

    {% if galleries %}
    <!-- Gallery Grid -->
    <div class="events-grid">
        {% for gallery in galleries %}
        {% set cover = gallery.coverImage or (gallery.photos[0].url if gallery.photos) %}
        <article class="event-card" data-gallery-id="{{ gallery.id }}">
            <div class="event-card-image">
                {% if cover %}
                    <img src="{{ cover }}" alt="{{ gallery.titleEn or gallery.title }}">
                {% else %}
                    <img src="{{ url_for('static', filename='images/1.jpeg') }}" alt="{{ gallery.titleEn or gallery.title }}">
                {% endif %}
                <div class="photo-count-badge">
                    <span class="photo-count-number">{{ gallery.photoCount or (gallery.photos|length) }}</span>
                    <span data-lang-photos="photosLabel">Photos</span>
                </div>
            </div>
                <div class="event-card-content">
                    <div class="event-date" data-gallery-date-hi="{{ gallery.date|default('', true) }}" data-gallery-date-en="{{ gallery.dateEn|default('', true) }}">{{ gallery.date or gallery.dateEn }}</div>
                    <h3 class="event-title" data-gallery-title-hi="{{ gallery.title|default('', true) }}" data-gallery-title-en="{{ gallery.titleEn|default('', true) }}">{{ gallery.title or gallery.titleEn }}</h3>
                    <p class="event-description" data-gallery-description-hi="{{ gallery.description|default('', true) }}" data-gallery-description-en="{{ gallery.descriptionEn|default('', true) }}">{{ gallery.description or gallery.descriptionEn }}</p>
                <button type="button" class="view-photos-btn" data-event-id="{{ gallery.id }}" data-lang-photos="viewPhotos">तस्वीरें देखें</button>
            </div>
        </article>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-gallery-state" data-lang-photos="emptyState">
        जल्द ही फोटो जोड़े जाएंगे।
    </div>
    {% endif %}
</div>

<!-- Photo Modal -->
<div id="photoModal" class="photo-modal">
    <div class="modal-content">
        <div class="modal-header">
            <div class="modal-title">
                <h2>Event Title</h2>
                <p>Event Date</p>
            </div>
            <button class="close-modal back-arrow-btn" onclick="gallery.closePhotoModal()" aria-label="Back">
                <span class="sr-only">Back</span>
            </button>
        </div>
        <div class="photos-grid">
            <!-- Photos will be loaded here -->
        </div>
    </div>
</div>

<!-- Lightbox for full-size images -->
<div id="lightbox" class="lightbox">
    <div class="lightbox-content">
        <button class="lightbox-close" onclick="gallery.closeLightbox()">&times;</button>
        <button class="lightbox-nav lightbox-prev" onclick="gallery.prevPhoto()">‹</button>
        <img id="lightboxImg" src="" alt="Full size photo">
        <button class="lightbox-nav lightbox-next" onclick="gallery.nextPhoto()">›</button>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<script>
    window.galleryData = {{ galleries_json|safe }};
    window.initialGalleryId = {{ gallery_id|tojson if gallery_id else 'null' }};
</script>
<script src="{{ url_for('static', filename='js/masonry.js') }}"></script>
<script src="{{ url_for('static', filename='js/photos.js') }}"></script>
<script>
    // Ensure translations are applied after page loads
    document.addEventListener('DOMContentLoaded', function() {
        setTimeout(function() {
            if (window.applyLanguage) {
                const lang = window.getCurrentLanguage ? window.getCurrentLanguage() : 'hi';
                window.applyLanguage(lang);
            }
        }, 300);
    });
    
    window.addEventListener('load', function() {
        setTimeout(function() {
            if (window.applyLanguage) {
                const lang = window.getCurrentLanguage ? window.getCurrentLanguage() : 'hi';
                window.applyLanguage(lang);
            }
        }, 200);
    });
</script>
{% endblock %}