{% extends "base.html" %}

{% block title %}Events - SantBhagatRam{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/events.css') }}">
{% endblock %}

{% block content %}
<div class="events-container">
    <!-- Header -->
    <!-- Banner Section -->
    <div class="page-banner">
        <div class="banner-content">
            <h1 data-lang-events="title">Events & Calendar</h1>
            <p data-lang-events="subtitle">Stay updated with our upcoming events and spiritual gatherings</p>
        </div>
        <div class="banner-image-container">
        </div>
    </div>

    <!-- Tabs Navigation -->
    <div class="events-tabs">
        <button class="tab-btn active" data-tab="upcoming" data-lang-events="tabUpcoming">Upcoming Events</button>
        <button class="tab-btn" data-tab="calendar" data-lang-events="tabCalendar">Event Calendar</button>
    </div>

    <!-- Upcoming Events Section -->
    <section class="events-section active" id="upcomingSection">
        <div class="events-grid" id="eventsGrid">
            {% for event in events %}
            <div class="event-card" data-event-id="{{ event.id }}">
                <div class="event-image">
                    {% set img_attrs = event.image|responsive_image(sizes="(max-width: 640px) 100vw, (max-width: 1024px)
                    50vw, (max-width: 1440px) 33vw, 400px", default_width=800) %}
                    <img src="{{ img_attrs.src }}" srcset="{{ img_attrs.srcset }}" sizes="{{ img_attrs.sizes }}"
                        alt="{{ event.titleEn }}" loading="lazy" decoding="async">
                </div>
                <div class="event-content">
                    <div class="event-date-time">
                        <span class="event-date">{{ event.date }}</span>
                        <span class="event-time">{{ event.time }}</span>
                    </div>
                    <h3 class="event-title" data-title-hi="{{ event.title }}" data-title-en="{{ event.titleEn }}">{{
                        event.title }}</h3>
                    <div class="event-location">
                        <span class="location-icon">üìç</span>
                        <span class="event-location-text" data-location-hi="{{ event.location }}"
                            data-location-en="{{ event.locationEn }}">{{ event.location }}</span>
                    </div>
                    <p class="event-description" data-description-hi="{{ event.description }}"
                        data-description-en="{{ event.descriptionEn }}">{{ event.description }}</p>
                    <div class="event-actions">
                        <div class="calendar-buttons">
                            <a href="#" class="calendar-btn google" data-add-google="{{ event.id }}">
                                <span>Google Calendar</span>
                            </a>
                            <a href="#" class="calendar-btn outlook" data-add-outlook="{{ event.id }}">
                                <span>Outlook</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </section>

    <!-- Calendar Section -->
    <section class="events-section" id="calendarSection">
        <div class="calendar-container">
            <div class="calendar-header">
                <button class="calendar-nav-btn" id="prevMonth" aria-label="Previous month">‚Äπ</button>
                <h2 class="calendar-month-year" id="calendarMonthYear"></h2>
                <button class="calendar-nav-btn" id="nextMonth" aria-label="Next month">‚Ä∫</button>
            </div>
            <div class="calendar-grid" id="calendarGrid">
                <!-- Calendar will be dynamically generated -->
            </div>
            <div class="calendar-legend">
                <div class="legend-item">
                    <span class="legend-dot has-event"></span>
                    <span data-lang-events="legendHasEvent">Has Events</span>
                </div>
                <div class="legend-item">
                    <span class="legend-dot today"></span>
                    <span data-lang-events="legendToday">Today</span>
                </div>
            </div>
        </div>

        <div class="selected-date-events" id="selectedDateEvents">
            <div class="no-events-message" data-lang-events="noEventsMessage">
                Select a date to view events
            </div>
        </div>

        <div class="upcoming-sidebar-list">
            <h3 class="upcoming-sidebar-title" data-lang-events="upcomingEventsSidebar">Upcoming Events</h3>
            <div class="upcoming-sidebar-items">
                {% for event in upcoming_events[:4] %}
                <div class="sidebar-event-card">
                    <div class="sidebar-event-date">
                        <span class="sidebar-day">{{ event.date.split('-')[2] }}</span>
                        <span class="sidebar-month">{{ event.date.split('-')[1] }}</span>
                    </div>
                    <div class="sidebar-event-info">
                        <h4 class="sidebar-event-title" data-title-hi="{{ event.title }}"
                            data-title-en="{{ event.titleEn }}">{{ event.titleEn }}</h4>
                        <div class="sidebar-event-meta">
                            <span data-location-hi="{{ event.location }}" data-location-en="{{ event.locationEn }}">üìç
                                {{ event.locationEn }}</span>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </section>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Pass events data to external script
    window.eventsData = {{ events_json | safe }};
    // Initialize defaults: server renders list initially (skipJsEventRender=true), 
    // but JS renders calendar (skipJsCalendarRender=false)
    window.skipJsEventRender = true;
    window.skipJsCalendarRender = false;
</script>
<script src="{{ url_for('static', filename='js/events.js') }}"></script>
{% endblock %}
{% endblock %}